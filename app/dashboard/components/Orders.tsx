"use client";

import { useState, useEffect, useCallback, useMemo, memo } from "react";

interface WebhookEvent {
  id: string;
  type: string;
  created: string;
  data: Record<string, unknown>;
  processed: boolean;
  error?: string;
}

interface EventStats {
  total: number;
  byType: Record<string, number>;
  last24Hours: number;
}

// EventRow Ïª¥Ìè¨ÎÑåÌä∏ (Î©îÎ™®Ïù¥Ï†úÏù¥ÏÖò)
const EventRow = memo(
  ({
    event,
    getEventTypeColor,
    getEventTypeLabel,
    getPaymentAmount,
    getPaymentMethod,
    getMembershipStatus,
    formatDate,
    openMembershipModal,
    deleteEvent,
  }: {
    event: WebhookEvent;
    getEventTypeColor: (type: string) => string;
    getEventTypeLabel: (type: string) => string;
    getPaymentAmount: (event: WebhookEvent) => {
      value: number;
      currency: string;
    };
    getPaymentMethod: (event: WebhookEvent) => string;
    getMembershipStatus: (event: WebhookEvent) => string | null;
    formatDate: (dateString: string) => string;
    openMembershipModal: (event: WebhookEvent) => void;
    deleteEvent: (id: string) => void;
  }) => {
    const amount = getPaymentAmount(event);
    const paymentMethod = getPaymentMethod(event);
    const membershipStatus = getMembershipStatus(event);

    return (
      <tr className="hover:bg-gray-50">
        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 sticky left-0 bg-white">
          <div className="flex items-center gap-2">
            <span className="cursor-pointer hover:text-blue-600 font-mono text-xs">
              {event.id}
            </span>
            <button
              className="text-gray-400 hover:text-gray-600"
              onClick={() => navigator.clipboard.writeText(event.id)}
            >
              üìã
            </button>
          </div>
        </td>
        <td className="px-6 py-4 whitespace-nowrap">
          <span
            className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${getEventTypeColor(
              event.type
            )}`}
          >
            {getEventTypeLabel(event.type)}
          </span>
        </td>
        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
          <div className="flex items-center gap-2">
            <span className="font-medium">
              {amount.currency === "KRW"
                ? `‚Ç©${amount.value.toLocaleString()}`
                : `${amount.value} ${amount.currency}`}
            </span>
            <span
              className={`px-2 py-1 text-xs rounded-full ${
                amount.currency === "KRW"
                  ? "bg-blue-100 text-blue-800"
                  : "bg-purple-100 text-purple-800"
              }`}
            >
              {amount.currency === "KRW" ? "‚Ç©" : amount.currency}
            </span>
          </div>
        </td>
        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
          <span
            className={`px-2 py-1 text-xs rounded-full ${
              paymentMethod.includes("Card")
                ? "bg-green-100 text-green-800"
                : "bg-purple-100 text-purple-800"
            }`}
          >
            {paymentMethod}
          </span>
        </td>
        <td className="px-6 py-4 whitespace-nowrap">
          <span
            className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
              event.processed
                ? "bg-green-100 text-green-800"
                : "bg-red-100 text-red-800"
            }`}
          >
            {event.processed ? "Ï≤òÎ¶¨Îê®" : "Ïò§Î•ò"}
          </span>
        </td>
        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
          {formatDate(event.created)}
        </td>
        <td className="px-6 py-4 whitespace-nowrap text-sm">
          {membershipStatus ? (
            <button
              onClick={() =>
                membershipStatus === "Ï†ÅÎ¶ΩÌïòÍ∏∞" && openMembershipModal(event)
              }
              className={`px-3 py-1 text-xs rounded-full ${
                membershipStatus === "Ï†ÅÎ¶ΩÌïòÍ∏∞"
                  ? "bg-blue-100 text-blue-800 hover:bg-blue-200 cursor-pointer"
                  : membershipStatus === "Íµ¨ÎèÖ Í¥ÄÎ¶¨"
                  ? "bg-yellow-100 text-yellow-800"
                  : "bg-green-100 text-green-800"
              }`}
            >
              {membershipStatus}
            </button>
          ) : (
            <span className="text-gray-400 text-xs">-</span>
          )}
        </td>
        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
          <button
            onClick={() => deleteEvent(event.id)}
            className="text-red-600 hover:text-red-900"
          >
            ÏÇ≠Ï†ú
          </button>
        </td>
      </tr>
    );
  }
);

EventRow.displayName = "EventRow";

export function Orders() {
  const [events, setEvents] = useState<WebhookEvent[]>([]);
  const [stats, setStats] = useState<EventStats | null>(null);
  const [loading, setLoading] = useState(true);
  const [selectedType, setSelectedType] = useState<string>("");
  const [autoRefresh, setAutoRefresh] = useState(true);
  const [connectionStatus, setConnectionStatus] = useState<
    "connecting" | "connected" | "disconnected"
  >("disconnected");
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [selectedEvent, setSelectedEvent] = useState<WebhookEvent | null>(null);
  const [barcodeInput, setBarcodeInput] = useState("");

  // Ïù¥Î≤§Ìä∏ ÌÉÄÏûÖÎ≥Ñ ÏÉâÏÉÅ Îß§Ìïë (Î©îÎ™®Ïù¥Ï†úÏù¥ÏÖò)
  const eventTypeColors = useMemo(
    () => ({
      "payment_intent.succeeded": "bg-green-100 text-green-800",
      "payment_intent.payment_failed": "bg-red-100 text-red-800",
      "customer.subscription.created": "bg-blue-100 text-blue-800",
      "customer.subscription.updated": "bg-yellow-100 text-yellow-800",
      "customer.subscription.deleted": "bg-red-100 text-red-800",
      "invoice.payment_succeeded": "bg-green-100 text-green-800",
      "invoice.payment_failed": "bg-red-100 text-red-800",
    }),
    []
  );

  const getEventTypeColor = useCallback(
    (type: string) => {
      return (
        (eventTypeColors as Record<string, string>)[type] ||
        "bg-gray-100 text-gray-800"
      );
    },
    [eventTypeColors]
  );

  // Ïù¥Î≤§Ìä∏ ÌÉÄÏûÖÏùÑ ÌïúÍµ≠Ïñ¥Î°ú Î≥ÄÌôò (Î©îÎ™®Ïù¥Ï†úÏù¥ÏÖò)
  const eventTypeLabels = useMemo(
    () => ({
      "payment_intent.succeeded": "Í≤∞Ï†ú ÏÑ±Í≥µ",
      "payment_intent.payment_failed": "Í≤∞Ï†ú Ïã§Ìå®",
      "customer.subscription.created": "Íµ¨ÎèÖ ÏÉùÏÑ±",
      "customer.subscription.updated": "Íµ¨ÎèÖ ÏóÖÎç∞Ïù¥Ìä∏",
      "customer.subscription.deleted": "Íµ¨ÎèÖ ÏÇ≠Ï†ú",
      "invoice.payment_succeeded": "Ïù∏Î≥¥Ïù¥Ïä§ Í≤∞Ï†ú ÏÑ±Í≥µ",
      "invoice.payment_failed": "Ïù∏Î≥¥Ïù¥Ïä§ Í≤∞Ï†ú Ïã§Ìå®",
    }),
    []
  );

  const getEventTypeLabel = useCallback(
    (type: string) => {
      return (eventTypeLabels as Record<string, string>)[type] || type;
    },
    [eventTypeLabels]
  );

  // Îç∞Ïù¥ÌÑ∞ Î°úÎìú
  const loadData = useCallback(async () => {
    try {
      setLoading(true);

      // Ïù¥Î≤§Ìä∏ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
      const eventsUrl = selectedType
        ? `/api/webhooks/events?type=${selectedType}&limit=100`
        : "/api/webhooks/events?limit=100";

      const [eventsResponse, statsResponse] = await Promise.all([
        fetch(eventsUrl),
        fetch("/api/webhooks/events?stats=true"),
      ]);

      if (eventsResponse.ok) {
        const eventsData = await eventsResponse.json();
        setEvents(eventsData.events || []);
      }

      if (statsResponse.ok) {
        const statsData = await statsResponse.json();
        setStats(statsData);
      }
    } catch (error) {
      console.error("Error loading webhook data:", error);
    } finally {
      setLoading(false);
    }
  }, [selectedType]);

  // ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ®
  useEffect(() => {
    loadData();

    if (autoRefresh) {
      const interval = setInterval(loadData, 5000); // 5Ï¥àÎßàÎã§ ÏÉàÎ°úÍ≥†Ïπ®
      return () => clearInterval(interval);
    }
  }, [selectedType, autoRefresh, loadData]);

  // Ïã§ÏãúÍ∞Ñ Ïó∞Í≤∞ ÏÉÅÌÉú ÌëúÏãú
  useEffect(() => {
    const updateConnectionStatus = () => {
      if (autoRefresh) {
        setConnectionStatus("connected");
      } else {
        setConnectionStatus("disconnected");
      }
    };

    updateConnectionStatus();
  }, [autoRefresh]);

  // Ïù¥Î≤§Ìä∏ ÏÇ≠Ï†ú
  const deleteEvent = useCallback(
    async (id: string) => {
      try {
        const response = await fetch(`/api/webhooks/events?id=${id}`, {
          method: "DELETE",
        });

        if (response.ok) {
          setEvents((prevEvents) =>
            prevEvents.filter((event) => event.id !== id)
          );
          loadData(); // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏Î•º ÏúÑÌï¥ Îã§Ïãú Î°úÎìú
        }
      } catch (error) {
        console.error("Error deleting event:", error);
      }
    },
    [loadData]
  );

  // Î™®Îì† Ïù¥Î≤§Ìä∏ ÏÇ≠Ï†ú
  const clearAllEvents = useCallback(async () => {
    if (!confirm("Î™®Îì† webhook Ïù¥Î≤§Ìä∏Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?")) {
      return;
    }

    try {
      const response = await fetch("/api/webhooks/events?clearAll=true", {
        method: "DELETE",
      });

      if (response.ok) {
        setEvents([]);
        loadData();
      }
    } catch (error) {
      console.error("Error clearing events:", error);
    }
  }, [loadData]);

  // ÎÇ†Ïßú Ìè¨Îß∑ÌåÖ (Î©îÎ™®Ïù¥Ï†úÏù¥ÏÖò)
  const formatDate = useCallback((dateString: string) => {
    const date = new Date(dateString);
    return date.toLocaleString("ko-KR", {
      year: "numeric",
      month: "2-digit",
      day: "2-digit",
      hour: "2-digit",
      minute: "2-digit",
      second: "2-digit",
    });
  }, []);

  // Î©§Î≤ÑÏã≠ Ï†ÅÏö© Ïó¨Î∂Ä Í≤∞Ï†ï (Î©îÎ™®Ïù¥Ï†úÏù¥ÏÖò)
  const getMembershipStatus = useCallback((event: WebhookEvent) => {
    if (event.type === "payment_intent.succeeded") {
      return "Ï†ÅÎ¶ΩÌïòÍ∏∞";
    } else if (event.type === "payment_intent.payment_failed") {
      return null;
    } else if (event.type.includes("subscription")) {
      return "Íµ¨ÎèÖ Í¥ÄÎ¶¨";
    } else {
      return null;
    }
  }, []);

  // Í≤∞Ï†ú Í∏àÏï° Ï∂îÏ∂ú (webhook Îç∞Ïù¥ÌÑ∞ÏóêÏÑú) (Î©îÎ™®Ïù¥Ï†úÏù¥ÏÖò)
  const getPaymentAmount = useCallback((event: WebhookEvent) => {
    if (
      event.type === "payment_intent.succeeded" ||
      event.type === "payment_intent.payment_failed"
    ) {
      const data = event.data as Record<string, unknown>;
      const object = data.object as Record<string, unknown>;
      if (object && object.amount) {
        return {
          value: (object.amount as number) / 100, // StripeÎäî ÏÑºÌä∏ Îã®ÏúÑÎ°ú Ï†ÄÏû•
          currency: (object.currency as string)?.toUpperCase() || "KRW",
        };
      }
    }
    return { value: 0, currency: "KRW" };
  }, []);

  // Í≤∞Ï†ú ÏàòÎã® Ï∂îÏ∂ú (Î©îÎ™®Ïù¥Ï†úÏù¥ÏÖò)
  const getPaymentMethod = useCallback((event: WebhookEvent) => {
    if (
      event.type === "payment_intent.succeeded" ||
      event.type === "payment_intent.payment_failed"
    ) {
      const data = event.data as Record<string, unknown>;
      const object = data.object as Record<string, unknown>;
      if (object && object.payment_method) {
        const paymentMethod = object.payment_method as Record<string, unknown>;
        return `Card (${
          (paymentMethod.type as string)?.toUpperCase() || "STRIPE"
        })`;
      }
    }
    return "Web3(USDC/Sui)";
  }, []);

  // Î™®Îã¨ Ïó¥Í∏∞ (Î©îÎ™®Ïù¥Ï†úÏù¥ÏÖò)
  const openMembershipModal = useCallback((event: WebhookEvent) => {
    setSelectedEvent(event);
    setIsModalOpen(true);
    setBarcodeInput("");
  }, []);

  // Î™®Îã¨ Îã´Í∏∞ (Î©îÎ™®Ïù¥Ï†úÏù¥ÏÖò)
  const closeMembershipModal = useCallback(() => {
    setIsModalOpen(false);
    setSelectedEvent(null);
    setBarcodeInput("");
  }, []);

  // Î©§Î≤ÑÏã≠ Ï†ÅÏö©ÌïòÍ∏∞ (Î©îÎ™®Ïù¥Ï†úÏù¥ÏÖò)
  const applyMembership = useCallback(async () => {
    if (!selectedEvent || !barcodeInput.trim()) {
      alert("Î∞îÏΩîÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");
      return;
    }

    try {
      // Ïó¨Í∏∞Ïóê Î©§Î≤ÑÏã≠ Ï†ÅÎ¶Ω API Ìò∏Ï∂ú Î°úÏßÅÏùÑ Ï∂îÍ∞ÄÌï† Ïàò ÏûàÏäµÎãàÎã§
      console.log("Î©§Î≤ÑÏã≠ Ï†ÅÎ¶Ω:", {
        eventId: selectedEvent.id,
        barcode: barcodeInput,
        amount: getPaymentAmount(selectedEvent),
      });

      alert("Î©§Î≤ÑÏã≠Ïù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†ÅÎ¶ΩÎêòÏóàÏäµÎãàÎã§!");
      closeMembershipModal();
    } catch (error) {
      console.error("Î©§Î≤ÑÏã≠ Ï†ÅÎ¶Ω Ïò§Î•ò:", error);
      alert("Î©§Î≤ÑÏã≠ Ï†ÅÎ¶Ω Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.");
    }
  }, [selectedEvent, barcodeInput, getPaymentAmount, closeMembershipModal]);
  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <div>
          <h2 className="text-2xl font-bold text-gray-900">Order Management</h2>
          <p className="text-gray-600">Ïã§ÏãúÍ∞Ñ Stripe webhook Ïù¥Î≤§Ìä∏ Î™®ÎãàÌÑ∞ÎßÅ</p>
        </div>
        <div className="flex gap-2 items-center">
          <div className="flex items-center gap-2">
            <div
              className={`w-2 h-2 rounded-full ${
                connectionStatus === "connected"
                  ? "bg-green-500"
                  : "bg-gray-400"
              }`}
            ></div>
            <span className="text-sm text-gray-600">
              {connectionStatus === "connected" ? "Ïã§ÏãúÍ∞Ñ Ïó∞Í≤∞Îê®" : "Ïó∞Í≤∞ ÎÅäÍπÄ"}
            </span>
          </div>
          <button
            onClick={() => setAutoRefresh(!autoRefresh)}
            className={`px-4 py-2 rounded-md text-sm font-medium ${
              autoRefresh
                ? "bg-green-100 text-green-800"
                : "bg-gray-100 text-gray-800"
            }`}
          >
            {autoRefresh ? "ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ® ON" : "ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ® OFF"}
          </button>
          <button
            onClick={loadData}
            className="px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700"
          >
            ÏÉàÎ°úÍ≥†Ïπ®
          </button>
          <button
            onClick={clearAllEvents}
            className="px-4 py-2 bg-red-600 text-white rounded-md text-sm font-medium hover:bg-red-700"
          >
            Ï†ÑÏ≤¥ ÏÇ≠Ï†ú
          </button>
        </div>
      </div>

      {/* Order Stats */}
      {stats && (
        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div className="bg-white rounded-lg shadow p-4">
            <h3 className="text-sm font-medium text-gray-500">Ï†ÑÏ≤¥ Ïù¥Î≤§Ìä∏</h3>
            <p className="text-2xl font-bold text-gray-900">{stats.total}</p>
          </div>
          <div className="bg-white rounded-lg shadow p-4">
            <h3 className="text-sm font-medium text-gray-500">ÏµúÍ∑º 24ÏãúÍ∞Ñ</h3>
            <p className="text-2xl font-bold text-blue-600">
              {stats.last24Hours}
            </p>
          </div>
          <div className="bg-white rounded-lg shadow p-4">
            <h3 className="text-sm font-medium text-gray-500">ÏÑ±Í≥µÌïú Í≤∞Ï†ú</h3>
            <p className="text-2xl font-bold text-green-600">
              {stats.byType["payment_intent.succeeded"] || 0}
            </p>
          </div>
          <div className="bg-white rounded-lg shadow p-4">
            <h3 className="text-sm font-medium text-gray-500">Ïã§Ìå®Ìïú Í≤∞Ï†ú</h3>
            <p className="text-2xl font-bold text-red-600">
              {stats.byType["payment_intent.payment_failed"] || 0}
            </p>
          </div>
        </div>
      )}

      {/* ÌïÑÌÑ∞ */}
      <div className="bg-white p-4 rounded-lg shadow">
        <div className="flex gap-4 items-center">
          <label className="text-sm font-medium text-gray-700">
            Ïù¥Î≤§Ìä∏ ÌÉÄÏûÖ ÌïÑÌÑ∞:
          </label>
          <select
            value={selectedType}
            onChange={(e) => setSelectedType(e.target.value)}
            className="px-3 py-2 border border-gray-300 rounded-md text-sm"
          >
            <option value="">Î™®Îì† ÌÉÄÏûÖ</option>
            {stats &&
              Object.keys(stats.byType).map((type) => (
                <option key={type} value={type}>
                  {getEventTypeLabel(type)} ({stats.byType[type]})
                </option>
              ))}
          </select>
        </div>
      </div>

      {/* Orders Table */}
      <div className="bg-white rounded-lg shadow overflow-hidden">
        <div className="px-6 py-4 border-b border-gray-200">
          <h3 className="text-lg font-medium text-gray-900">Webhook Ïù¥Î≤§Ìä∏</h3>
        </div>

        {loading ? (
          <div className="p-6 text-center">
            <div className="text-gray-500">Î°úÎî© Ï§ë...</div>
          </div>
        ) : events.length === 0 ? (
          <div className="p-6 text-center">
            <div className="text-gray-500">webhook Ïù¥Î≤§Ìä∏Í∞Ä ÏóÜÏäµÎãàÎã§.</div>
          </div>
        ) : (
          <div className="overflow-x-auto">
            <table className="min-w-full divide-y divide-gray-200">
              <thead className="bg-gray-50">
                <tr>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky left-0 bg-gray-50">
                    Ïù¥Î≤§Ìä∏ ID
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Ïù¥Î≤§Ìä∏ ÌÉÄÏûÖ
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Í∏àÏï°
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Í≤∞Ï†ú ÏàòÎã®
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    ÏÉÅÌÉú
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Î∞úÏÉù ÏãúÍ∞Ñ
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Î©§Î≤ÑÏã≠
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Ïï°ÏÖò
                  </th>
                </tr>
              </thead>
              <tbody className="bg-white divide-y divide-gray-200">
                {events.map((event) => (
                  <EventRow
                    key={event.id}
                    event={event}
                    getEventTypeColor={getEventTypeColor}
                    getEventTypeLabel={getEventTypeLabel}
                    getPaymentAmount={getPaymentAmount}
                    getPaymentMethod={getPaymentMethod}
                    getMembershipStatus={getMembershipStatus}
                    formatDate={formatDate}
                    openMembershipModal={openMembershipModal}
                    deleteEvent={deleteEvent}
                  />
                ))}
              </tbody>
            </table>
          </div>
        )}
      </div>

      {/* Î©§Î≤ÑÏã≠ Ï†ÅÎ¶Ω Î™®Îã¨ */}
      {isModalOpen && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
            {/* Î™®Îã¨ Ìó§Îçî */}
            <div className="px-6 py-4 border-b border-gray-200">
              <h3 className="text-lg font-medium text-gray-900">
                NFC ÌòπÏùÄ Î∞îÏΩîÎìúÎ°ú Î©§Î≤ÑÏã≠ÏùÑ Ïù∏ÏãùÌï¥Ï£ºÏÑ∏Ïöî
              </h3>
            </div>

            {/* Î™®Îã¨ ÎÇ¥Ïö© */}
            <div className="px-6 py-4 space-y-6">
              {/* NFC Ïù¥ÎØ∏ÏßÄ */}
              <div className="text-center">
                <div className="mx-auto w-24 h-24 bg-gray-100 rounded-lg flex items-center justify-center mb-2">
                  <svg
                    className="w-12 h-12 text-gray-400"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      strokeLinecap="round"
                      strokeLinejoin="round"
                      strokeWidth={2}
                      d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"
                    />
                  </svg>
                </div>
                <p className="text-sm text-gray-600">
                  NFC Ïπ¥ÎìúÎ•º ÌÉúÍ∑∏Ìï¥Ï£ºÏÑ∏Ïöî.
                </p>
              </div>

              {/* Î∞îÏΩîÎìú ÏûÖÎ†• */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Î©§Î≤ÑÏã≠ Î∞îÏΩîÎìú
                </label>
                <input
                  type="text"
                  value={barcodeInput}
                  onChange={(e) => setBarcodeInput(e.target.value)}
                  placeholder="Î∞îÏΩîÎìúÎ•º Ï∞çÏñ¥Ï£ºÏÑ∏Ïöî"
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              {/* Í≤∞Ï†ú Ï†ïÎ≥¥ ÌëúÏãú */}
              {selectedEvent && (
                <div className="bg-gray-50 rounded-lg p-4">
                  <h4 className="text-sm font-medium text-gray-700 mb-2">
                    Í≤∞Ï†ú Ï†ïÎ≥¥
                  </h4>
                  <div className="space-y-1 text-sm text-gray-600">
                    <div>
                      Í∏àÏï°:{" "}
                      {(() => {
                        const amount = getPaymentAmount(selectedEvent);
                        return amount.currency === "KRW"
                          ? `‚Ç©${amount.value.toLocaleString()}`
                          : `${amount.value} ${amount.currency}`;
                      })()}
                    </div>
                    <div>Í≤∞Ï†ú ÏàòÎã®: {getPaymentMethod(selectedEvent)}</div>
                    <div>Í≤∞Ï†ú ÏãúÍ∞Ñ: {formatDate(selectedEvent.created)}</div>
                  </div>
                </div>
              )}
            </div>

            {/* Î™®Îã¨ Ìë∏ÌÑ∞ */}
            <div className="px-6 py-4 border-t border-gray-200 flex gap-3 justify-end">
              <button
                onClick={closeMembershipModal}
                className="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500"
              >
                Ï∑®ÏÜå
              </button>
              <button
                onClick={applyMembership}
                className="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                Ï†ÅÏö©ÌïòÍ∏∞
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
